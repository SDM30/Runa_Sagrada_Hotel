<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="description" content="Runa Sagrada - Panel de Administración" />
    <meta name="keywords" content="staff, dashboard, gestión, clientes" />
    <meta name="author" content="Runa Sagrada" />

    <title>Admin Dashboard - Runa Sagrada</title>

    <!-- Preload critical assets -->
    <link rel="preload" th:href="@{/images/logito.png}" as="image" />

    <!-- Stylesheets -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" th:href="@{/styles/styles.css}" />
    <link rel="stylesheet" th:href="@{/styles/styles1.css}" />
  </head>
  <body class="dashboard-container">
    <button
      class="sidebar-toggle d-lg-none"
      type="button"
      id="sidebarToggle"
      aria-controls="sidebar"
      aria-expanded="false"
      aria-label="Alternar navegación"
    >
      <i class="fas fa-bars"></i>
    </button>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <img
          th:src="@{/images/logito.png}"
          alt="Runa Sagrada"
          class="sidebar-logo"
        />
        <h2 class="sidebar-title">Staff Panel</h2>
      </div>

      <nav
        class="sidebar-nav nav flex-column"
        id="sidebarTab"
        role="tablist"
        aria-orientation="vertical"
      >
        <a
          class="sidebar-nav-link"
          th:href="@{/dashboard}"
          role="tab"
        >
          <span>Dashboard</span>
        </a>

        <a
          class="sidebar-nav-link"
          th:href="@{/hotel/staff}"
          role="tab"
        >
          <span>Gestión Hoteles</span>
        </a>

        <a
          class="sidebar-nav-link active"
          th:href="@{/room/staff}"
          role="tab"
        >
          <span>Gestión Habitaciones</span>
        </a>

        <a
          class="sidebar-nav-link"
          th:href="@{/service/staff}"
          role="tab"
        >
          <span>Gestión Servicios</span>
        </a>

        <a
          class="sidebar-nav-link"
          th:href="@{/finance/staff}"
          role="tab"
        >
          <span>Finanzas</span>
        </a>

        <a
          class="sidebar-nav-link"
          th:href="@{/report/staff}"
          role="tab"
        >
          <span>Reportes</span>
        </a>

        <a
          class="sidebar-nav-link text-white bg-danger rounded-pill mt-3 text-center"
          th:href="@{/}"
          role="tab"
        >
          <span>Volver al sitio</span>
        </a>
      </nav>
    </aside>

    <!-- Dashboard Header -->
    <header class="dashboard-header">
      <h1 class="dashboard-title">Panel de Administración</h1>
      <p class="dashboard-subtitle">
        Gestiona todos los aspectos de Runa Sagrada desde un solo lugar
      </p>
    </header>

    <!-- Main Content -->
    <main class="main-content tab-content">
      <!-- Tabla Section Habitaciones -->
      <section class="tabla-section tab-pane fade show active" id="habitaciones">
        <div class="tabla-header">
          <h2 class="tabla-title">Gestión de Habitaciones</h2>
          <div class="tabla-actions">
            <button
              class="btn btn-gradient"
              data-bs-toggle="modal"
              data-bs-target="#modalCRoom"
            >
              <i class="fas fa-plus me-2"></i>Agregar Nueva
            </button>
            <button class="btn btn-outline-light" onclick="window.location.reload()">
              <i class="fas fa-sync-alt me-2"></i>Actualizar
            </button>
          </div>
        </div>

        <!-- Buscador -->
        <form
          id="search-form"
          th:action="@{/room/staff/search}"
          method="post"
          class="row g-2 mb-3"
        >
          <div class="col">
            <input
              type="text"
              name="name"
              class="form-control"
              placeholder="Nombre de habitación"
            />
          </div>
          <div class="col">
            <input
              type="number"
              name="minCapacity"
              class="form-control"
              placeholder="Capacidad mínima"
            />
          </div>
          <div class="col">
            <input
              type="number"
              name="maxCapacity"
              class="form-control"
              placeholder="Capacidad máxima"
            />
          </div>
          <div class="col-auto">
            <button type="submit" class="btn btn-primary">Buscar</button>
          </div>
        </form>

        <div
          th:if="${successMessage}"
          class="alert alert-info alert-dismissible fade show"
          role="alert"
        >
          <i class="fas fa-info-circle me-2"></i>
          <span th:text="${successMessage}"></span>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Cerrar"
          ></button>
        </div>

        <div
          th:if="${errorMessage}"
          class="alert alert-danger alert-dismissible fade show"
          role="alert"
        >
          <i class="fas fa-exclamation-circle me-2"></i>
          <span th:text="${errorMessage}"></span>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Cerrar"
          ></button>
        </div>

        <div class="tabla-content">
          <div class="table-responsive h-100" th:if="${rooms != null and !rooms.empty}">
            <table class="table table-striped mb-0 h-100">
              <thead>
                <tr>
                  <th scope="col">ID</th>
                  <th scope="col">Nombre</th>
                  <th scope="col">Capacidad</th>
                  <th scope="col">Precio Base</th>
                  <th scope="col">Descripción</th>
                  <th scope="col">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="room : ${rooms}">
                  <td th:text="${room.id}"></td>
                  <td th:text="${room.name}"></td>
                  <td th:text="${room.capacity}"></td>
                  <td th:text="${'$' + room.basePrice}"></td>
                  <td>
                    <span th:if="${room.description != null and room.description.length() > 50}" 
                          th:attr="data-bs-title=${room.description}"
                          data-bs-toggle="tooltip"
                          th:text="${room.description.substring(0, 50) + '...'}"></span>
                    <span th:unless="${room.description != null and room.description.length() > 50}" 
                          th:text="${room.description != null ? room.description : 'Sin descripción'}"></span>
                  </td>
                  <td>
                    <div class="btn-group" role="group">
                      <button
                        type="button"
                        class="btn btn-warning btn-sm"
                        data-bs-toggle="modal"
                        data-bs-target="#modalURoom"
                        th:data-id="${room.id}"
                        th:data-name="${room.name}"
                        th:data-capacity="${room.capacity}"
                        th:data-baseprice="${room.basePrice}"
                        th:data-description="${room.description}"
                        onclick="loadRoomData(this)"
                      >
                        <i class="fas fa-edit"></i> Editar
                      </button>
                      <a
                        class="btn btn-danger btn-sm"
                        th:href="@{/room/staff/delete/{id}(id=${room.id})}"
                        onclick="return confirm('¿Está seguro de que desea eliminar esta habitación?')"
                      >
                        <i class="fas fa-trash"></i> Eliminar
                      </a>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="tabla-placeholder" th:if="${rooms == null or rooms.empty}">
            <i class="fas fa-bed fa-3x mb-3 text-muted"></i>
            <h3>Gestión de Habitaciones</h3>
            <p>
              En esta sección puedes gestionar todas las habitaciones del hotel.
            </p>
            <button class="btn btn-gradient mt-3" data-bs-toggle="modal" data-bs-target="#modalCRoom">
              <i class="fas fa-plus me-2"></i>Registrar Habitación
            </button>
          </div>
        </div>
      </section>

      <!-- Modal Registro Habitación -->
      <div
        class="modal fade"
        id="modalCRoom"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
        aria-labelledby="staticBackdropLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <form
            th:action="@{/room/staff/add}"
            th:object="${newroom}"
            method="post"
            class="modal-content"
          >
            <div class="modal-header">
              <h5 class="modal-title" id="modalRoomLabel">
                Registrar Habitación
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Cerrar"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="name" class="form-label">Nombre de la habitación</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  th:field="*{name}"
                  required
                  minlength="2"
                  maxlength="50"
                />
              </div>

              <div class="mb-3">
                <label for="capacity" class="form-label">Capacidad</label>
                <input
                  type="number"
                  class="form-control"
                  id="capacity"
                  th:field="*{capacity}"
                  required
                  min="1"
                  max="10"
                />
              </div>

              <div class="mb-3">
                <label for="basePrice" class="form-label">Precio Base</label>
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="basePrice"
                  th:field="*{basePrice}"
                  required
                  min="0"
                />
              </div>

              <div class="mb-3">
                <label for="description" class="form-label">Descripción</label>
                <textarea
                  class="form-control"
                  id="description"
                  th:field="*{description}"
                  rows="3"
                  maxlength="255"
                ></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cerrar
              </button>
              <button type="submit" class="btn btn-primary">Registrar</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal Actualizar Habitación -->
      <div
        class="modal fade"
        id="modalURoom"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
        aria-labelledby="modalURoomLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <form
            th:action="@{/room/staff/update}"
            th:object="${newroom}"
            method="post"
            class="modal-content"
            id="edit-room-form"
          >
            <div class="modal-header">
              <h5 class="modal-title" id="modalURoomLabel">Actualizar Habitación</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Cerrar"
              ></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="updateId" name="id" th:field="*{id}" />

              <div class="mb-3">
                <label for="updateName" class="form-label">Nombre *</label>
                <input
                  type="text"
                  class="form-control"
                  id="updateName"
                  name="name"
                  th:field="*{name}"
                  required
                  minlength="2"
                  maxlength="50"
                />
              </div>

              <div class="mb-3">
                <label for="updateCapacity" class="form-label">Capacidad (personas) *</label>
                <input
                  type="number"
                  class="form-control"
                  id="updateCapacity"
                  name="capacity"
                  th:field="*{capacity}"
                  required
                  min="1"
                  max="10"
                />
              </div>

              <div class="mb-3">
                <label for="updateBasePrice" class="form-label">Precio Base ($) *</label>
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="updateBasePrice"
                  name="basePrice"
                  th:field="*{basePrice}"
                  required
                  min="0"
                />
              </div>

              <div class="mb-3">
                <label for="updateDescription" class="form-label">Descripción</label>
                <textarea
                  class="form-control"
                  id="updateDescription"
                  name="description"
                  th:field="*{description}"
                  rows="3"
                  maxlength="255"
                ></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancelar
              </button>
              <button type="submit" class="btn btn-primary">Actualizar Habitación</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Otras secciones -->
      <section class="tabla-section tab-pane fade" id="servicios">
        <h1>TODO</h1>
      </section>

      <section class="tabla-section tab-pane fade" id="dashboard">
        <h1>TODO</h1>
      </section>
    </main>

    <!-- Scripts -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script th:src="@{/js/script.js}" defer></script>
  </body>
</html>